CREATE DATABASE IF NOT EXISTS LibraryManagementSystem CHARACTER SET UTF8MB4;
USE LibraryManagementSystem;
CREATE TABLE IF NOT EXISTS book
(
    book_id       INTEGER AUTO_INCREMENT PRIMARY KEY,
    book_name     VARCHAR(30) NOT NULL,
    book_author   VARCHAR(20) DEFAULT '未知作者',
    book_price    DECIMAL     NOT NULL,
    press         VARCHAR(20) DEFAULT '未知出版社',
    book_number   INTEGER     NOT NULL,
    borrow_number INTEGER     DEFAULT 0,
    CONSTRAINT CHECK ( book_price > 0 ),
    CHECK ( borrow_number >= 0 )
);
CREATE TABLE IF NOT EXISTS user
(
    user_id       INTEGER AUTO_INCREMENT PRIMARY KEY,
    user_name     VARCHAR(100) NOT NULL,
    user_password VARCHAR(50)  NOT NULL,
    role          VARCHAR(10) DEFAULT 'user'
);
CREATE TABLE IF NOT EXISTS borrow_record
(
    borrow_book_ID INTEGER,
    borrow_user_ID INTEGER,
    borrow_date    DATE NOT NULL,
    return_date    DATE NOT NULL,
    CONSTRAINT CHECK ( return_date > borrow_record.borrow_date ),
    CONSTRAINT FOREIGN KEY (borrow_book_ID) REFERENCES LibraryManagementSystem.book (book_id),
    CONSTRAINT FOREIGN KEY (borrow_user_ID) REFERENCES LibraryManagementSystem.user (user_id)
);
